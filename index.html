<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <meta charset="UTF-8">
    <title>IoT-Pen Framework Showcase</title>

</head>

<body>
    <input type="text" id="ips" value="192.168.0.1"></inpu>
    <button id="send-ips">Send IP-Addresses</button>

    <div class="container">
    </div>
</body>

</html>
<script type="module">
    document.getElementById("send-ips").addEventListener("click", sendData);
    var valueToSend = "127.0.0.1";
    const url = 'http://localhost:5000/api/json';

    function sendData() {
        // Get the value you want to send

        var adresses = document.getElementById("ips");
        if (adresses.value) {
            valueToSend = adresses.value
        }
        // Make a POST request to the server
        fetch("http://localhost:5000/api/ips", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(valueToSend)
        })
            .then(response => {
                if (response.ok) {
                    console.log("Value sent successfully!");
                    const container = document.getElementsByClassName("container")[0];

                    while (container.firstChild) {
                        container.removeChild(container.firstChild);
                    }
                    retrieve_Data();
                } else {
                    console.error("Error sending value:", response.statusText);
                }
            })
            .catch(error => {
                console.error("Error sending value:", error);
            });
    }
    var temp;
    async function retrieve_Data() {
        try {
            const response = await axios.get(url);
            // Handle the response data
            var adresses = document.getElementById("ips");

            temp = response.data;
            const container = document.getElementsByClassName("container")[0];



            const h2 = document.createElement("h2")
            h2.textContent = "Result for " + adresses.value;
            container.appendChild(h2);

            temp.forEach((element)=>{
                element=JSON.parse(element)
                for (let i = 0; i < element.length; i++) {
                    if ((i + 1) % 4 === 1) {
                        const h3 = document.createElement("h3")
                        h3.textContent = element[i];
                        container.appendChild(h3);
                    } else if ((i + 1) % 4 === 2 || (i + 1) % 4 === 3) {
                        const para = document.createElement("p")
                        para.textContent = element[i];
                        container.appendChild(para);
                    } else {
                        // Action for fourth entry in each set
                        if (element[i].cvssMetricV2) {
                            let para = document.createElement("p")
                            para.textContent = "Base Severity: " + element[i].cvssMetricV2[0].baseSeverity;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Access Complexity: " + element[i].cvssMetricV2[0].cvssData.accessComplexity;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Access Vector: " + element[i].cvssMetricV2[0].cvssData.accessVector;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Authentication: " + element[i].cvssMetricV2[0].cvssData.authentication;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Availability Impact: " + element[i].cvssMetricV2[0].cvssData.availabilityImpact;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Exploitability Score: " + element[i].cvssMetricV2[0].exploitabilityScore;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Impact Score: " + element[i].cvssMetricV2[0].impactScore;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Can obatin all privilege: " + element[i].cvssMetricV2[0].obtainAllPrivilege;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Can obtain other privilege: " + element[i].cvssMetricV2[0].obtainOtherPrivilege;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Can obtain User privilege: " + element[i].cvssMetricV2[0].obtainUserPrivilege;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Is User interaction required: " + element[i].cvssMetricV2[0].userInteractionRequired;
                            container.appendChild(para);
                        }
                        else {
                            let para = document.createElement("p")
                            para.textContent = "Attack Complexity: " + element[i].cvssMetricV31[0].cvssData.attackComplexity;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Attack Vector: " + element[i].cvssMetricV31[0].cvssData.attackVector;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Availability Impact: " + element[i].cvssMetricV31[0].cvssData.availabilityImpact;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Base Score: " + element[i].cvssMetricV31[0].cvssData.baseScore;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Base Severity: " + element[i].cvssMetricV31[0].cvssData.baseSeverity;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Confidentiality Impact: " + element[i].cvssMetricV31[0].cvssData.confidentialityImpact;
                            container.appendChild(para);
                            para = document.createElement("p");
                            para.textContent = "Integrity Impact: " + element[i].cvssMetricV31[0].cvssData.integrityImpact;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Privileges Required: " + element[i].cvssMetricV31[0].cvssData.privilegesRequired;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Scope: " + element[i].cvssMetricV31[0].cvssData.scope;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "User Interaction: " + element[i].cvssMetricV31[0].cvssData.userInteraction;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Exploitability Score: " + element[i].cvssMetricV31[0].exploitabilityScore;
                            container.appendChild(para);
                            para = document.createElement("p")
                            para.textContent = "Impact Score: " + element[i].cvssMetricV31[0].impactScore;
                            container.appendChild(para);
                        }

                    }
                }
            })




        } catch (error) {
            // Handle any errors
            console.error('Error:', error);
        }
    }



    // Usage
    retrieve_Data();


</script>