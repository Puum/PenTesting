<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <meta charset="UTF-8">
    <title>IoT-Pen Framework Showcase</title>

</head>

<body>
    <input type="text" id="ips" value="127.0.0.1"></inpu>
    <button id="send-ips">Send IP-Addresses</button>

    <div class="container">
    </div>
</body>

</html>
<script type="module">
    document.getElementById("send-ips").addEventListener("click", sendData);
    var valueToSend = "127.0.0.1";
    const url = 'http://localhost:5000/api/json';

    retrieve_Data();
    function sendData() {
        // Get the value you want to send

        var adresses = document.getElementById("ips");
        if (adresses.value) {
            valueToSend = adresses.value
        }
        // Make a POST request to the server
        fetch("http://localhost:5000/api/ips", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ IP: valueToSend })
        })
            .then(response => {
                if (response.ok) {
                    console.log("Value sent successfully!");
                    const container = document.getElementsByClassName("container")[0];

                    while (container.firstChild) {
                        container.removeChild(container.firstChild);
                    }
                    retrieve_Data();
                } else {
                    console.error("Error sending value:", response.statusText);
                }
            })
            .catch(error => {
                console.error("Error sending value:", error);
            });
    }
    var temp;
    async function retrieve_Data() {
        try {
            const response = await axios.get(url);
            // Handle the response data
            var adresses = document.getElementById("ips");

            temp = response.data;
            const container = document.getElementsByClassName("container")[0];



            const h2 = document.createElement("h2")
            h2.textContent = "Result for " + adresses.value;
            container.appendChild(h2);

            for (let i = 0; i < temp.length; i++) {
                if ((i + 1) % 4 === 1) {
                    const h3 = document.createElement("h3")
                    h3.textContent = temp[i];
                    container.appendChild(h3);
                } else if ((i + 1) % 4 === 2 || (i + 1) % 4 === 3) {
                    const para = document.createElement("p")
                    para.textContent = temp[i];
                    container.appendChild(para);
                } else {
                    // Action for fourth entry in each set
                    if (temp[i].cvssMetricV2) {
                        let para = document.createElement("p")
                        para.textContent = "Base Severity: " + temp[i].cvssMetricV2[0].baseSeverity;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Access Complexity: " + temp[i].cvssMetricV2[0].cvssData.accessComplexity;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Access Vector: " + temp[i].cvssMetricV2[0].cvssData.accessVector;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Authentication: " + temp[i].cvssMetricV2[0].cvssData.authentication;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Availability Impact: " + temp[i].cvssMetricV2[0].cvssData.availabilityImpact;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Exploitability Score: " + temp[i].cvssMetricV2[0].exploitabilityScore;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Impact Score: " + temp[i].cvssMetricV2[0].impactScore;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Can obatin all privilege: " + temp[i].cvssMetricV2[0].obtainAllPrivilege;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Can obtain other privilege: " + temp[i].cvssMetricV2[0].obtainOtherPrivilege;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Can obtain User privilege: " + temp[i].cvssMetricV2[0].obtainUserPrivilege;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Is User interaction required: " + temp[i].cvssMetricV2[0].userInteractionRequired;
                        container.appendChild(para);
                    }
                    else {
                        let para = document.createElement("p")
                        para.textContent = "Attack Complexity: " + temp[i].cvssMetricV31[0].cvssData.attackComplexity;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Attack Vector: " + temp[i].cvssMetricV31[0].cvssData.attackVector;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Availability Impact: " + temp[i].cvssMetricV31[0].cvssData.availabilityImpact;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Base Score: " + temp[i].cvssMetricV31[0].cvssData.baseScore;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Base Severity: " + temp[i].cvssMetricV31[0].cvssData.baseSeverity;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Confidentiality Impact: " + temp[i].cvssMetricV31[0].cvssData.confidentialityImpact;
                        container.appendChild(para);
                        para = document.createElement("p");
                        para.textContent = "Integrity Impact: " + temp[i].cvssMetricV31[0].cvssData.integrityImpact;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Privileges Required: " + temp[i].cvssMetricV31[0].cvssData.privilegesRequired;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Scope: " + temp[i].cvssMetricV31[0].cvssData.scope;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "User Interaction: " + temp[i].cvssMetricV31[0].cvssData.userInteraction;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Exploitability Score: " + temp[i].cvssMetricV31[0].exploitabilityScore;
                        container.appendChild(para);
                        para = document.createElement("p")
                        para.textContent = "Impact Score: " + temp[i].cvssMetricV31[0].impactScore;
                        container.appendChild(para);
                    }

                }
            }

        } catch (error) {
            // Handle any errors
            console.error('Error:', error);
        }
    }



    // Usage
    retrieve_Data();


</script>